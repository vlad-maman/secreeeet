<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∞—Ä—Ç–æ–≤—ñ –ß–∞—Å—É: –§—ñ–Ω–∞–ª—å–Ω–µ –°–≤—è—Ç–∫—É–≤–∞–Ω–Ω—è</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Marck+Script&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffd700; --ice: #00c6ff; --snow: rgba(255, 255, 255, 0.15); }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #010108; font-family: 'Montserrat', sans-serif; color: white; }

        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        #game-map { width: 6000px; height: 5000px; position: absolute; background: radial-gradient(circle at center, #1a1a4a 0%, #020210 100%); transition: opacity 0.5s; }

        /* –Ü–ù–¢–ï–†'–Ñ–† –•–ê–¢–ò–ù–ö–ò (–ü–†–ò–•–û–í–ê–ù–ò–ô –°–ü–û–ß–ê–¢–ö–£) */
        #house-interior {
            display: none; position: fixed; inset: 0; 
            background: radial-gradient(circle, #4b2c20, #2a1810);
            z-index: 5000; flex-direction: column; align-items: center; justify-content: center;
            border: 20px solid #1a0f0a;
        }

        /* –•–ê–¢–ò–ù–ö–ê –¢–ê –î–ò–ú */
        .cabin { position: absolute; width: 220px; height: 160px; background: #4b2c20; border: 6px solid #2a1810; border-radius: 10px; z-index: 20; }
        .cabin-roof { position: absolute; top: -65px; left: -25px; width: 0; height: 0; border-left: 130px solid transparent; border-right: 130px solid transparent; border-bottom: 75px solid #2a1810; }
        .chimney { position: absolute; top: -50px; right: 35px; width: 35px; height: 55px; background: #333; }
        .smoke { position: absolute; width: 20px; height: 20px; background: rgba(255,255,255,0.4); border-radius: 50%; filter: blur(12px); animation: smokeUp 3s infinite linear; }
        @keyframes smokeUp { 0% { transform: translateY(0); opacity: 0; } 100% { transform: translate(40px, -180px) scale(5); opacity: 0; } }

        /* –û–ë'–Ñ–ö–¢–ò */
        .tree { position: absolute; font-size: 7rem; z-index: 10; pointer-events: none; transform: translate(-50%, -50%); }
        .path { position: absolute; background: var(--snow); border-radius: 100px; filter: blur(30px); z-index: 1; }
        .npc { position: absolute; z-index: 100; display: flex; flex-direction: column; align-items: center; text-align: center; }
        .sprite { font-size: 4.5rem; filter: drop-shadow(0 5px 15px #000); animation: idle 1s infinite alternate; }
        @keyframes idle { from { transform: translateY(0); } to { transform: translateY(-10px); } }

        .item { position: absolute; z-index: 50; font-size: 3.5rem; animation: bounce 2s infinite ease-in-out; }
        @keyframes bounce { 0%,100% { transform: scale(1); } 50% { transform: scale(1.3); } }

        .bubble { position: absolute; bottom: 130%; background: white; color: black; padding: 10px 15px; border-radius: 20px; font-size: 0.8rem; width: 180px; display: none; border: 3px solid var(--ice); z-index: 2000; }

        #ui { position: fixed; top: 20px; left: 20px; background: rgba(0,0,0,0.85); padding: 20px; border-radius: 20px; border: 2px solid var(--gold); z-index: 9999; }
        .done { color: #4eff4e !important; text-decoration: line-through; opacity: 0.6; }

        #player { position: absolute; width: 80px; height: 80px; z-index: 1000; display: flex; flex-direction: column; align-items: center; }
        #start-screen { position: fixed; inset: 0; background: #05051a; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; }
        
        /* –í–ï–ß–Ü–†–ö–ê */
        .party-npc { font-size: 5rem; margin: 20px; display: inline-block; animation: jump 0.5s infinite alternate; }
        @keyframes jump { from { transform: translateY(0); } to { transform: translateY(-20px); } }
        .garland { position: absolute; top: 20px; width: 100%; text-align: center; font-size: 2rem; color: var(--gold); animation: flash 1s infinite; }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="font-family:'Marck Script'; font-size:5rem; color:var(--gold);">–í–∞—Ä—Ç–æ–≤—ñ –ß–∞—Å—É</h1>
        <button onclick="startGame()" style="padding:20px 60px; font-size:1.5rem; background:var(--gold); border:none; border-radius:50px; cursor:pointer; font-weight:bold;">–ü–û–ß–ê–¢–ò</button>
    </div>

    <div id="house-interior">
        <div class="garland">‚ú® üéÑ –ó –ù–û–í–ò–ú –†–û–ö–û–ú –¢–ê –†–Ü–ó–î–í–û–ú! üéÑ ‚ú®</div>
        <h2 style="font-family:'Marck Script'; font-size:4rem; color:var(--gold);">–í–µ—á—ñ—Ä–∫–∞ —É –õ—ñ—Å–Ω–∏–∫–∞!</h2>
        <div style="font-size: 8rem; margin: 20px;">üéâ üç∞ ü•Ç</div>
        <div>
            <span class="party-npc">ü¶å</span>
            <span class="party-npc">‚òÉÔ∏è</span>
            <span class="party-npc">üßù‚Äç‚ôÇÔ∏è</span>
            <span class="party-npc">üå≥</span>
            <span class="party-npc">üßù</span>
        </div>
        <p style="font-size: 1.5rem; color: var(--ice);">–î—è–∫—É—î–º–æ, —â–æ –≤—Ä—è—Ç—É–≤–∞–ª–∏ –ö—Ä–∏—Å—Ç–∞–ª –ß–∞—Å—É!</p>
        <button onclick="location.reload()" style="padding:10px 30px; border-radius:20px; background:white; border:none; cursor:pointer;">–ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
    </div>

    <div id="ui" style="display:none;">
        <div id="q1" class="quest-item">‚ö™ –í—ñ–¥–¥–∞—Ç–∏ –¥–∑–≤–æ–Ω–∏–∫ –†—É–¥–æ–ª—å—Ñ—É</div>
        <div id="q2" class="quest-item">‚ö™ –í—ñ–¥–¥–∞—Ç–∏ –º–æ—Ä–∫–≤—É –ë—É–ª—å—Ü—ñ</div>
        <div id="q3" class="quest-item">‚ö™ –í—ñ–¥–¥–∞—Ç–∏ –∫–ª—é—á –î—É–±—É</div>
        <div id="q4" class="quest-item">‚ö™ –í—ñ–¥–¥–∞—Ç–∏ –ª—ñ—Ö—Ç–∞—Ä–∏–∫ –û—Ö–æ—Ä–æ–Ω—Ü—é</div>
        <div id="inv" style="margin-top:10px; color:var(--gold); font-size:0.8rem;">–†—é–∫–∑–∞–∫: –ø–æ—Ä–æ–∂–Ω—å–æ</div>
    </div>

    <div id="viewport">
        <div id="game-map">
            <div class="path" style="width: 4000px; height: 140px; top: 2500px; left: 500px;"></div>
            <div class="path" style="width: 140px; height: 3500px; top: 500px; left: 2500px;"></div>

            <div class="cabin" id="main-house" style="top: 2420px; left: 2400px;">
                <div class="cabin-roof"></div>
                <div class="chimney" id="chimney"></div>
                <div id="door-glow" style="position:absolute; bottom:0; left:50%; transform:translateX(-50%); font-size:3rem; opacity:0.3;">üö™</div>
            </div>

            <div id="forest-layer"></div>

            <div class="npc" style="top: 600px; left: 1000px;"><div class="bubble" id="b-rudolf"></div><div class="sprite">ü¶å</div></div>
            <div class="npc" style="top: 4000px; left: 2500px;"><div class="bubble" id="b-snowman"></div><div class="sprite">‚òÉÔ∏è</div></div>
            <div class="npc" style="top: 2500px; left: 5000px;"><div class="bubble" id="b-oak"></div><div class="sprite">üå≥</div></div>
            <div class="npc" style="top: 4500px; left: 5500px;"><div class="bubble" id="b-guard"></div><div class="sprite">üßù</div></div>

            <div id="item-bell" class="item" style="top: 4800px; left: 200px;">üîî</div>
            <div id="item-carrot" class="item" style="top: 2500px; left: 5800px;">ü•ï</div>
            <div id="item-key" class="item" style="top: 100px; left: 5000px;">üîë</div>
            <div id="item-lamp" class="item" style="top: 4800px; left: 5800px;">üèÆ</div>
            <div id="crystal" class="item" style="top: 200px; left: 200px; display:none; font-size:7rem; z-index:1000;">üíé</div>

            <div id="player">
                <div class="bubble" id="p-bubble"></div>
                <div class="sprite" id="p-sprite">üßù‚Äç‚ôÇÔ∏è</div>
            </div>
        </div>
    </div>

<script>
    let pX = 2500, pY = 2700;
    let keys = {};
    let inv = { bell: false, carrot: false, key: false, lamp: false };
    let done = { bell: false, carrot: false, key: false, lamp: false };
    let hasCrystal = false;
    let isRunning = false;

    // –ì–ï–ù–ï–†–ê–¶–Ü–Ø –õ–Ü–°–£ –ë–ï–ó –°–ö–õ–ï–Æ–í–ê–ù–ù–Ø
    const forest = document.getElementById('forest-layer');
    const trees = [];
    for(let i=0; i<300; i++) {
        let tx = Math.random() * 5800;
        let ty = Math.random() * 4800;
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∏—Å—Ç–∞–Ω—Ü—ñ—ó, —â–æ–± –¥–µ—Ä–µ–≤–∞ –Ω–µ –∑–ª–∏–ø–∞–ª–∏—Å—è
        let tooClose = trees.some(t => Math.hypot(t.x - tx, t.y - ty) < 150);
        // –ù–µ —Å—Ç–∞–≤–∏—Ç–∏ –Ω–∞ –¥–æ—Ä–æ–≥–∏
        if(Math.abs(ty - 2500) < 200 || Math.abs(tx - 2500) < 200) tooClose = true;

        if(!tooClose) {
            const tr = document.createElement('div');
            tr.className = 'tree';
            tr.innerText = ['üéÑ', 'üå≤', 'üå≥'][Math.floor(Math.random()*3)];
            tr.style.left = tx + 'px';
            tr.style.top = ty + 'px';
            forest.appendChild(tr);
            trees.push({x: tx, y: ty});
        }
    }

    function makeSmoke() {
        setInterval(() => {
            const s = document.createElement('div');
            s.className = 'smoke';
            s.style.left = Math.random()*20+'px';
            document.getElementById('chimney').appendChild(s);
            setTimeout(() => s.remove(), 3000);
        }, 500);
    }

    window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('ui').style.display = 'block';
        isRunning = true;
        makeSmoke();
        loop();
    }

    function loop() {
        if(!isRunning) return;
        const s = 15;
        if(keys['w'] || keys['—Ü']) pY -= s;
        if(keys['s'] || keys['—ñ']) pY += s;
        if(keys['a'] || keys['—Ñ']) { pX -= s; document.getElementById('p-sprite').style.transform = 'scaleX(-1)'; }
        if(keys['d'] || keys['–≤']) { pX += s; document.getElementById('p-sprite').style.transform = 'scaleX(1)'; }

        pX = Math.max(100, Math.min(5900, pX));
        pY = Math.max(100, Math.min(4900, pY));

        const map = document.getElementById('game-map');
        map.style.left = (window.innerWidth/2 - pX)+'px';
        map.style.top = (window.innerHeight/2 - pY)+'px';
        document.getElementById('player').style.left = pX+'px';
        document.getElementById('player').style.top = pY+'px';

        if(keys['e'] || keys['—É']) handleE();
        requestAnimationFrame(loop);
    }

    function handleE() {
        // –ü—ñ–¥–±—ñ—Ä
        distCheck(pX, pY, 200, 4800, 150, () => { if(!inv.bell && !done.bell) { inv.bell = true; hide('item-bell'); msg('p-bubble', "–í–∑—è–≤ –¥–∑–≤–æ–Ω–∏–∫!"); } });
        distCheck(pX, pY, 5800, 2500, 150, () => { if(!inv.carrot && !done.carrot) { inv.carrot = true; hide('item-carrot'); msg('p-bubble', "–í–∑—è–≤ –º–æ—Ä–∫–≤—É!"); } });
        distCheck(pX, pY, 5000, 100, 150, () => { if(!inv.key && !done.key) { inv.key = true; hide('item-key'); msg('p-bubble', "–í–∑—è–≤ –∫–ª—é—á!"); } });
        distCheck(pX, pY, 5800, 4800, 150, () => { if(!inv.lamp && !done.lamp) { inv.lamp = true; hide('item-lamp'); msg('p-bubble', "–í–∑—è–≤ –ª—ñ—Ö—Ç–∞—Ä–∏–∫!"); } });

        // –í—ñ–¥–¥–∞—á–∞ NPC
        distCheck(pX, pY, 1000, 600, 150, () => { if(inv.bell) { inv.bell = false; done.bell = true; finishQ('q1'); } else if(!done.bell) msg('b-rudolf', "–®—É–∫–∞–π –¥–∑–≤–æ–Ω–∏–∫ –Ω–∞ –ü–¥-–ó—Ö!"); });
        distCheck(pX, pY, 2500, 4000, 150, () => { if(inv.carrot) { inv.carrot = false; done.carrot = true; finishQ('q2'); } else if(!done.carrot) msg('b-snowman', "–ú–æ—Ä–∫–≤–∞ –Ω–∞ –°—Ö–æ–¥—ñ!"); });
        distCheck(pX, pY, 5000, 2500, 150, () => { if(inv.key) { inv.key = false; done.key = true; finishQ('q3'); } else if(!done.key) msg('b-oak', "–ö–ª—é—á –Ω–∞ –ü—ñ–≤–Ω–æ—á—ñ!"); });
        distCheck(pX, pY, 5500, 4500, 150, () => { 
            if(inv.lamp) { inv.lamp = false; done.lamp = true; finishQ('q4'); document.getElementById('crystal').style.display='block'; } 
            else if(!done.lamp) msg('b-guard', "–ü—Ä–∏–Ω–µ—Å–∏ –ª—ñ—Ö—Ç–∞—Ä–∏–∫ –∑ –∫—É—Ç–∫–∞!"); 
        });

        // –ö—Ä–∏—Å—Ç–∞–ª
        distCheck(pX, pY, 200, 200, 150, () => { 
            if(done.bell && done.carrot && done.key && done.lamp) {
                hasCrystal = true;
                hide('crystal');
                document.getElementById('door-glow').style.opacity = "1";
                document.getElementById('door-glow').style.textShadow = "0 0 20px gold";
                msg('p-bubble', "–ö—Ä–∏—Å—Ç–∞–ª —É –º–µ–Ω–µ! –¢–µ–ø–µ—Ä –¥–æ —Ö–∞—Ç–∏–Ω–∫–∏ —Å–≤—è—Ç–∫—É–≤–∞—Ç–∏!");
            }
        });

        // –í—Ö—ñ–¥ –≤ –¥—ñ–º
        distCheck(pX, pY, 2400, 2420, 200, () => {
            if(hasCrystal) {
                isRunning = false;
                document.getElementById('house-interior').style.display = 'flex';
            }
        });

        updateInv();
    }

    function distCheck(x, y, tx, ty, d, cb) { if(Math.hypot(x-tx, y-ty) < d) cb(); }
    function hide(id) { document.getElementById(id).style.display = 'none'; }
    function msg(id, txt) { const b = document.getElementById(id); b.innerText = txt; b.style.display = 'block'; setTimeout(() => b.style.display='none', 3000); }
    function finishQ(id) { const q = document.getElementById(id); q.classList.add('done'); q.innerText = "‚úÖ " + q.innerText.substring(2); }
    function updateInv() {
        let items = [];
        if(inv.bell) items.push("üîî"); if(inv.carrot) items.push("ü•ï"); if(inv.key) items.push("üîë"); if(inv.lamp) items.push("üèÆ");
        document.getElementById('inv').innerText = "–†—é–∫–∑–∞–∫: " + (items.length ? items.join(" ") : "–ø–æ—Ä–æ–∂–Ω—å–æ");
    }
</script>
</body>
</html>